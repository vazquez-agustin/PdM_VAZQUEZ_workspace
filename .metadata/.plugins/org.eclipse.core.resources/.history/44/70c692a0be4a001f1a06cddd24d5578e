
#include "API_debounce.h"

// Enum privado
typedef enum{

BUTTON_UP,  // Estado: inicial (no presionado)
BUTTON_FALLING,  // Estado: siendo presionado
BUTTON_DOWN, // Estado: totalmente presionado
BUTTON_RAISING, // Estado: se suelta el bot√≥n

} debounceState_t;

// Variable global privado
static bool_t button_pressed;

// Variable global privada (con static)
static debounceState_t currentState;


bool_t isButtonDown() {

	if (currentState == BUTTON_DOWN) {

		return true;

	} else {

		return false;

	}

}

void debounceFSM_init(void){

	currentState = BUTTON_UP;

  }

void writeKey() {

	button_pressed = true;

}

bool_t readKey() {

	if (button_pressed) {

		button_pressed = false;

		return true;

	}

	return button_pressed;

}

  void debounceFSM_update(void) {

  	  switch(estadoActual) {

  	  case BUTTON_UP:

  		currentState = BUTTON_FALLING;
  		  break;

  	  case BUTTON_FALLING:

  		  if (readKey()) {

  			currentState = BUTTON_DOWN;

  		  } else {

  			currentState = BUTTON_UP;

  		  }

  		  break;

  	  case BUTTON_RAISING:

  		  if (!readKey()) {

  			currentState = BUTTON_UP;

  		  } else {

  			currentState = BUTTON_DOWN;

  		  }

  		  break;

  	  case BUTTON_DOWN:

  		  estadoActual = BUTTON_RAISING;

  		  break;

  	  default:

  		  debounceFSM_init();

  		  break;

  	  }

    }




