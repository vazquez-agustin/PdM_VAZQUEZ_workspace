
/* Define to prevent recursive inclusion -------------------------------------*/

#ifndef API_API_DELAY_H_
#define API_API_DELAY_H_

#ifdef __cplusplus
extern "C" {
#endif

/* Includes ------------------------------------------------------------------*/

#include "stm32f4xx_hal.h"
#include <stdint.h>  // Necesario para uint32_t
#include <stdbool.h> // Necesario para bool

/* Exported types ------------------------------------------------------------*/
typedef uint32_t tick_t; // Representa un tipo de dato para almacenar un tiempo o conteo en milisegundos
typedef bool bool_t; // Representa un tipo de dato booleano

typedef struct {
   tick_t startTime; // Almacena el tiempo en milisegundos cuando se inició el retardo
   tick_t duration;  // Almacena la duración del retardo en milisegundos
   bool_t running;  // Es un booleano que indica si el retardo está en curso (true) o no (false)
} delay_t;

/* Exported functions prototypes ---------------------------------------------*/

void Error_Handler(void);

/*
 * Inicializa la estructura delay_t con la duración especificada, configurando running a
 * false inicialmente.
 *
 * */
void delayInit(delay_t *delay, tick_t duration);

/*
 * Verifica el estado del retardo. Si running es false, inicia el retardo y retorna false.
 * Si running es true, verifica si ha transcurrido la duración del retardo desde startTime y
 * retorna true si se ha cumplido el tiempo, reiniciando running a false en ese caso.
 *
 * */
bool_t delayRead(delay_t *delay);

/*
 * Permite cambiar la duración de un retardo existente actualizando el campo duration en la
 * estructura delay_t.
 *
 * */
void delayWrite(delay_t *delay, tick_t duration);

/*
 *
 * Esta función devuelve el estado del campo `running` de la estructura `delay_t`,
 * indicando si el retardo no bloqueante está en curso o no.
 * Es útil para comprobar si se puede cambiar la duración del retardo sin
 * interferir con un retardo en curso.
 *
 * @param delay Puntero a la estructura `delay_t` que representa el retardo.
 * @return `true` si el retardo está corriendo, `false` si no lo está.
 *
 * */
bool_t delayIsRunning(delay_t *delay);


#ifdef __cplusplus
}
#endif

#endif /* API_API_DELAY_H_ */
